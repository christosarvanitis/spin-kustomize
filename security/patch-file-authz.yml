#-----------------------------------------------------------------------------------------------------------------
# Example configuration for reading roles (groups) used by spinnaker from a file. This requires setting up
# an authn provider which will provide the username coming from an external system.
#
# Documentation: https://kb.armory.io/s/article/Authorization-Configuration-with-File-Based-Role-Definitions
#-----------------------------------------------------------------------------------------------------------------
apiVersion: spinnaker.armory.io/v1alpha2
kind: SpinnakerService
metadata:
  name: spinnaker
spec:
  kustomize:
    fiat:
      deployment:
        patchesJson6902: |
          - op: add
            path: /spec/template/spec/containers/0/volumeMounts/-
            value:
              mountPath: /tmp/fiat-roles
              name: spin-fiat-roles
          - op: add
            path: /spec/template/spec/volumes/-
            value:
              name: spin-fiat-roles
              configMap:
                name: fiat-roles
  spinnakerConfig:
    profiles:
      fiat:
        fiat:
          defaultToUnrestrictedUser: true
        auth:
          groupMembership:
            service: file
            file:
              path: /tmp/fiat-roles/rolemappings.yml
      orca:
        tasks:
          useManagedServiceAccounts: true
    config:
      security:
        authz:
          enabled: true
